pipeline {
    agent any

    environment {
        GODOT_BIN = 'C:\\JenkinsTools\\Godot\\godot.exe' 
        EXPORT_PRESET_WIN = 'Windows Desktop' 
        BUILD_PATH = 'builds/windows'
        PROJECT_NAME = 'HypersonicSim'
    }

    stages {
        stage('Checkout') {
            steps {
                checkout scm
            }
        }

        stage('Setup Dependencies') {
            steps {
                script {
                    bat "if not exist ${BUILD_PATH} mkdir ${BUILD_PATH}"
                }
            }
        }

        stage('Build (Export)') {
            steps {
                echo 'Building Windows Binary...'
                bat """
                "${GODOT_BIN}" --headless --path . --export-release "${EXPORT_PRESET_WIN}" "${BUILD_PATH}/${PROJECT_NAME}.exe"
                """
            }
        }

        stage('Archive Artifacts') {
            steps {
                archiveArtifacts artifacts: "${BUILD_PATH}/**/*", fingerprint: true
            }
        }
    }

    post {
        success {
            echo 'Build Sucesso! O Simulador est√° pronto.'
        }
        failure {
            echo 'O Build quebrou. Verifique os logs.'
        }
    }
}
